---
title: Javascript二进制浮点数和四舍五入错误
date: 2017-09-30 23:11:24
categories: "前端"
tags:
     - javascript
description:
---

> Javascript的浮点数采用的是二进制表示法，虽然不清楚具体的算法，但知道这种表示法会造成浮点数的误差。如果网站要进行高精度的计算，涉及经融或大计算领域，尽可能使用整数运算。
<!--more-->

实数有无数多个，但Javascript通过浮点数形式只能表示其中的有限个数（确切地说是*18 437 736 874 454 810 627*个）。也就是说，当在Javascript中使用实数的时候，常常只是**真实值的一个近似表示**。

Javascript采用了IEEE-754浮点数表示法（几乎所有现代编程语言所采用），这是一种二进制表示法，可以精确地表示分数，比如,1/2、1/8和1/1024。遗憾的是，我们常用的分数都是十进制分数1/10、1/100等。二进制浮点数表示法并不能精确表示类似0.1这样简单的数字。

**Javascript中数字具有足够的精度，并可以极其近似于0.1.但事实上，数字不能精确表述的确带来一些问题。看下这段代码：
```
var x = .3 - .2;  // 30美分减去20美分
var y = .2 - .1;  // 20美分减去10美分
x == y            // => false:两值不相等
x == .1           // => false: .3-.2不等于 .1
y == .1           // => true: .2-.1等于.1
```

由于**舍入误差**，0.3和0.2之间的近似差值实际上不等于0.2和0.1之间的近似差值<sup>注译1</sup>。这个问题并不只在Javascript中才出现，理解这一点非常重要：在任何使用二进制浮点数的编程语言都会有这个问题。通过需要主要的是，上述代码中x和y的值非常接近彼此和最终的正确值。这种计算结果可以胜任大多数的计算任务：这个问题也只有在比较两个值是否相等的时候才会出现。

Javascript的未来版本或许会支持十进制数字类型以避免这些舍入问题。在这之前你可以更愿意使用大整数进行重要的金融计算，例如，要使用整数“分”而不要使用小数“圆”进行基于货币单位的运算。

*注译1：在Javascript的真实环境中，0.3-0.2=0.099 999 999 999 999 98*

---
title: Javascript带操作的赋值运算——小坑
date: 2017-10-01 21:46:49
categories: "前端"
tags:
     - javascript
description:
---

> 所谓“带操作的赋值运算”，就是带“op =”的赋值运算，比如*=。在一般情况下，这种表达式会有几乎等价的语句。但在特殊情况下，它们又是有区别的。
<!--more-->

带操作的赋值运算有很多，如`+=`、`-=`、`*=`、`/=`、`%=`等，还有跟二进制运算有关的运算符，我这里就不一一列举出来了。

大多数情况下，表达式为
```
a op = b
```
这里`op`代表一个运算符，这个表达式如下面的表达式等价：
```
a=a op b
```
**在第一行中，表达式a只计算了一次，在第二行中，表达式a计算了两次**。只有a包含具有副作用的表达式的时候，两者才不等价。比如，下面两个表达式就是不等价的：
```
data[i++] *= 2
data[i++] = data[i++] * 2
```
可能不太容易看懂，我们举个实例
```
// 例一
var data = [1,3,5]; // 定义一个数组
var i = 0;
data[i++] *= 2;
console.log(data);  // => [2,3,5]
console.log(i); // => 1：计算了一次

// 例二
var data = [1,3,5]; // 初始化数组
var i = 0;
data[i++] = data[i++] * 2
console.log(data);  // => [6,3,5]
console.log(i); // => 2:计算了两次
```
**分析：**

例一中，表达式将左侧的`i++`放在了最后，首先计算了`data[0]*2`的值，得到`2`，再将`2`赋值给了`data[0]`，最后才运算`i++`；

例二中，表达式首先计算了右侧的`i++`，所以右侧的值为`data[1]*2`即`6`。然后将右侧的值赋值给`data[1]`，最后再执行一次左侧的`i++`。

可以说，这种带副作用的运算十分复杂和混乱，建议实际上不要将带副作用的左值放在左侧。
